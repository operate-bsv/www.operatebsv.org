(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{513:function(e,t,a){e.exports=a.p+"assets/img/lua-vs-js.e0e7f4d8.png"},514:function(e,t,a){e.exports=a.p+"assets/img/lua-vs-js@2x.61a372f3.png"},618:function(e,t,a){"use strict";a.r(t);var n=a(41),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[e._v("One of the more eyebrow-raising aspects of Operate’s design is that Ops - the on-chain functions that power-up your Bitcoin transactions - are written using the "),n("a",{attrs:{href:"https://www.lua.org/about.html",target:"_blank",rel:"noopener"}},[e._v("Lua scripting language"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("A few people have asked me, "),n("em",[e._v("“why Lua?”")]),e._v(", but this is a question that demands more than a 280 character tweet. So grab a cuppa and make yourself comfy whilst I explain how I settled on Lua and why I think it’s a good choice.")]),e._v(" "),n("h2",{attrs:{id:"before-operate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#before-operate"}},[e._v("#")]),e._v(" Before Operate")]),e._v(" "),n("p",[e._v("At the beginning of 2019 I was working on an experimental project called "),n("a",{attrs:{href:"https://github.com/functional-bitcoin/",target:"_blank",rel:"noopener"}},[e._v("Functional Bitcoin"),n("OutboundLink")],1),e._v(". This work was really just a learning exercise, and Operate is what Functional Bitcoin would have been if I knew then what I knew now.")]),e._v(" "),n("p",[e._v("Functional Bitcoin used JavaScript for its on-chain functions. A logical choice because JavaScript is the most popular scripting language in the world, has the most vibrant developer ecosystem with endless resources and open source libraries, and offers the broadest reach in terms of potential users.")]),e._v(" "),n("p",[e._v("In addition, one of my goals is to get this technology working in the browser. Given all of this, JavaScript would seem like an obvious choice.")]),e._v(" "),n("h2",{attrs:{id:"sandboxing"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sandboxing"}},[e._v("#")]),e._v(" Sandboxing")]),e._v(" "),n("p",[e._v("The fundamental design of Operate and Functional Bitcoin are the same. Anyone is able to publish code on-chain, and any other party may end up loading and running that "),n("em",[e._v("untrusted")]),e._v(" code. So in theory, attackers may publish malicious code in functions, and try to get other parties to run that code.")]),e._v(" "),n("p",[e._v("The solution to this problem is to sandbox the environment in which functions are run. If the functions can’t access the host’s file system, kill processes, make changes the the host’s environment, or access any sensitive data, there's little damage an attacker can cause. In the case of browsers, we need to prevent the functions from accessing the current origin’s cookies and local storage.")]),e._v(" "),n("p",[e._v("In Functional Bitcoin I made use of the "),n("a",{attrs:{href:"https://github.com/patriksimek/vm2",target:"_blank",rel:"noopener"}},[n("code",[e._v("vm2")]),e._v(" module"),n("OutboundLink")],1),e._v(", which is a very solid sandbox solution for Node.js, but not one that is usable in browser environments. I looked in to some convoluted solutions involving iFrames and web workers, but I’m not aware of any truly battle-hardened browser sandbox solutions.")]),e._v(" "),n("p",[e._v("Eventually I came to the conclusion that, perhaps ironically, JavaScript wasn’t going to be the solution if I wanted to get this stuff working in the browser.")]),e._v(" "),n("h2",{attrs:{id:"enter-lua"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enter-lua"}},[e._v("#")]),e._v(" Enter Lua")]),e._v(" "),n("figure",{staticClass:"fr mt0 mr0 mb3 ml4 pa0"},[n("img",{attrs:{src:"https://www.lua.org/images/lua-logo.gif",alt:"Lua"}})]),e._v(" "),n("p",[e._v("When I started work on Operate, I spent some time researching possible alternatives to JavaScript. My primary concern was the sandboxing issue, but I also wanted to find a scripting language that could be embedded and used in different languages and platforms - so Operate would not necessarily be tied to one platform. And I wanted something lightweight, nimble and easy to learn.")]),e._v(" "),n("p",[e._v("It didn't take long for me to realise that Lua not only ticked all those boxes, it was pretty much the stand-out candidate. If you want to let users run in-process, Turing-complete scripts from untrusted sources, Lua is the best language for the job.")]),e._v(" "),n("p",[e._v("Lua was always "),n("em",[e._v("designed")]),e._v(" to be embedded. Something like Operate is exactly the use case Lua excels at. Effective sandboxing is easily achieved, and due to Lua's simple lightweight design, it is a very easy language to learn.")]),e._v(" "),n("p",[e._v("There are a few other languages occupying a similar space to Lua, but I considered them all a bit too obscure. Lua is actually quite widely used in some surprising places - for example in "),n("a",{attrs:{href:"https://github.com/openresty/lua-nginx-module",target:"_blank",rel:"noopener"}},[e._v("nginx"),n("OutboundLink")],1),e._v(" and "),n("a",{attrs:{href:"https://redis.io/commands/eval",target:"_blank",rel:"noopener"}},[e._v("Redis"),n("OutboundLink")],1),e._v(", in embedded hardware, and particularly in "),n("a",{attrs:{href:"https://love2d.org/",target:"_blank",rel:"noopener"}},[e._v("games"),n("OutboundLink")],1),e._v(" and the "),n("a",{attrs:{href:"https://developer.roblox.com/en-us/learn-roblox/coding-scripts",target:"_blank",rel:"noopener"}},[e._v("game-modding"),n("OutboundLink")],1),e._v(" scene - so has a reasonable ecosystem around it.")]),e._v(" "),n("p",[e._v("I then discovered there were solid implementations of Lua available to both "),n("a",{attrs:{href:"https://github.com/rvirding/luerl",target:"_blank",rel:"noopener"}},[e._v("Elixir/Erlang"),n("OutboundLink")],1),e._v(" and "),n("a",{attrs:{href:"https://fengari.io/",target:"_blank",rel:"noopener"}},[e._v("JavaScript"),n("OutboundLink")],1),e._v(" and the decision was made. Operate would use Lua.")]),e._v(" "),n("h2",{attrs:{id:"lua-vs-javascript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lua-vs-javascript"}},[e._v("#")]),e._v(" Lua vs JavaScript")]),e._v(" "),n("p",[e._v("Both languages are actually "),n("em",[e._v("very")]),e._v(" similar. They are both prototype-based languages with similar(ish) variable scoping rules. There are some "),n("a",{attrs:{href:"https://stackoverflow.com/questions/1022560/subtle-differences-between-javascript-and-lua#answer-1022683",target:"_blank",rel:"noopener"}},[e._v("subtle differences"),n("OutboundLink")],1),e._v(" between the two, but fundamentally switching from one to the other is pretty easy. I suspect anyone competent in JavaScript can wrap their head around Lua in one afternoon of playing with code.")]),e._v(" "),n("figure",{staticClass:"mv4 mh0 pa0"},[n("img",{attrs:{src:a(513),srcset:a(514)+" 2x",alt:"Lua vs JavaScript"}})]),e._v(" "),n("p",[e._v("One difference that is relevant to Operate is how Lua handles binary data. Rather than using Buffers and converting to and from strings, in Lua strings are just sequences of individual bytes that can contain any arbitrary binary data. I prefer this - it means we can just read any data from Bitcoin transactions, and whether it is a UTF-8 string or some other binary data, we can use it in the same way.")]),e._v(" "),n("p",[e._v('Lua is a small language. It has few concepts to learn, just one data type (the all-flexible "table" - similar to a JavaScript object but any value can be a key) and a minimal but useful standard library.')]),e._v(" "),n("p",[e._v("Some will undoubtedly find Lua a more restrictive environment than JavaScript, and it certainly has a "),n("strong",[e._v("much")]),e._v(" smaller ecosystem of resources and open source libraries. But when it comes to Operate this isn't such a problem. Whilst there is no limit to how large and complex your Ops become, I envisage most Ops will be small, single-purpose functions designed to do one thing and do it well.")]),e._v(" "),n("h2",{attrs:{id:"to-the-browser-and-beyond"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#to-the-browser-and-beyond"}},[e._v("#")]),e._v(" To the browser and beyond")]),e._v(" "),n("p",[e._v("At the start of this article I stated that it is a goal to see Operate in the browser. Then I went on to abandon JavaScript and create the agent software in Elixir running Ops written in Lua. How does this get in the browser?")]),e._v(" "),n("p",[e._v("JavaScript has an "),n("a",{attrs:{href:"https://fengari.io/",target:"_blank",rel:"noopener"}},[e._v("excellent implementation of Lua"),n("OutboundLink")],1),e._v(" that can be used in the browser. Very soon you will see an Operate agent written in JavaScript. Any programming language that has an implementation of a Lua VM can in theory have the Operate agent ported to it. Soon, Bitcoin transactions made for Operate will be able to be executed in a safe sandboxed environment, in the browser, Node.js, Elixir, and more platforms, and always return the same consistent result.")]),e._v(" "),n("p",[e._v("That is why Lua.")])])}),[],!1,null,null,null);t.default=s.exports}}]);